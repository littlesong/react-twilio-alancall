# INTRODUCTION

This is a demo web app that allows the user to calling US phone numbers. Currently (2022-09) this is only a basic demo version for proving the concept of making outbound phone calls from web. It only supports the following functions in this version.

- Dial any specified US phone number
- Import phone numbers from CSV file

## Components

This React app is using two backend services

    - a twilio serveless api for dialing phone#

        See /src/utils/dial-api.js

        To config this endpoint, update `DialApi` object in the above file.

    - a RESTful endpoint hosted on AWS (as part of GreenAward) for managing the polls, questions and the answers
    
        See /src/utils/restUtil.js

---------------
# Source Code Folder Structure

## root (/)

    The root is also the project root of the react app

## /infra

    Scripts for setting up the hosting environments

### /infra/twilio/api-host

    (Not used. Needs work) The code for deploying twilio API functions.

### /infra/twilio/api-host

    The code for deploying the React app to twilio

## /serverless

    Temp. May not be needed.
    TODO: test and remove this folder if it is not needed

## /src

    The React app /src folder.

## /build

    Temp target directory generated by the build command.


---------------
# SETUP

## Setup the dial function

Follow the following steps to deploy the **dial** function to twilio. Note. You need a twilio phone# to make it work.

- Login in to twilio console
- In **Functions and Assets** create a Service. Ie. alancall
- Create a function in the above service. Ie. dial
- Deploy the function code from /functions/src/dialphone.js. This can be done by copy the source code and paste into the function body.
- Change the function to 'Public' if it is not.
- Then press 'Deploy All' to deploy the function. Mark down the service url (ie. `alancall-5826.twil.io`)
- Test the function using the following url: https://<service-url>/<function-name>?phone=<phone#-to-dial>. For example:

    https://alancall-5826.twil.io/dial?phone=16137977535

- Update the service name and function name in the `/utils/dial-api.js` file. This is needed for the react app to call the dial function.

### View function logs

You can show live logs for debugging by loading the Services page in the Twilio Console, opening the Service to track, and clicking the Show Logs toggle in the bottom-right corner of the UI.

## Deploy the website  

Follow the following steps to deploy the REACT website to twilio. Also see https://www.twilio.com/blog/deploy-react-application-twilio-serverless-toolkit

- Install Twilio CLI tool (see https://www.twilio.com/docs/twilio-cli/quickstart)
- run `twilio login`
- run `npm run deploy:twilio:react`
- Now the react app should have been deployed to twilio. Mark down the service url. Ie. `alancall-react-5626-dev.twil.io`
- Test it with the following url: https://<service-url>/index.html.


--------------
# Local Dev

    Run `npm run start`

    This will launch the website locally for development purposes.


--------------
# Web App Usage

Web app url: https://<alancall-react-service-url>/index.html

## Pages

You can select the page on the main menu.

### Call

This is the default (home) page. You can dial a specific phone# from this page

### Data

TBD. Manages the life cycle of the stored phone numbers.

### Import

On this page, you can import phone numbers from CSV file generated by Molin's generator tool.
1. Press Choose File to select the CSV file you want to import
2. Then press Import
3. 


-------------
# Ref

- [Host React app on twilio](https://www.twilio.com/blog/deploy-react-application-twilio-serverless-toolkit)
- [Twilio function context/event data structures](https://www.twilio.com/docs/serverless/functions-assets/functions/invocation)
- [Twilio voice API](https://www.twilio.com/docs/voice/make-calls)
